x <- read_xlsx('./data/raw/CNA18_C_7_11.xlsx', sheet="7.11.1",
skip=7, col_names = col_names) %>%
select(-starts_with("vacia")) %>%
mutate(link = as.character(link)) %>%
filter(!grepl('Fuente|El total ', link)) %>%
fill(link, depto, .direction = "downup")
View(x)
x <- read_xlsx('./data/raw/CNA18_C_7_11.xlsx', sheet="7.11.1",
skip=7, col_names = col_names) %>%
select(-starts_with("vacia")) %>%
mutate(link = as.character(link)) %>%
filter(!grepl('Fuente|El total ', link))
View(x)
x <- read_xlsx('./data/raw/CNA18_C_7_11.xlsx', sheet="7.11.1",
skip=7, col_names = col_names) %>%
select(-starts_with("vacia")) %>%
mutate(link = as.character(link)) %>%
filter(!grepl('Fuente|El total ', link)) %>%
filter(if_any(everything(), ~ !is.na(.))) %>%
fill(link, depto, .direction = "downup")
View(x)
if (nchar(x$link[1]) == 1){
prov_cod <- paste0("0", x$link[1])
} else {
prov_cod <- x$link[1]
}
x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
)
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
mutate(across(total:sd, ~case_when(
.x == "-" ~ 0,
.x == "s" ~ NA_character_,
TRUE ~ .x
)))
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
mutate(across(c(total:sd), ~case_when(
. == "-" ~ 0,
. == "s" ~ NA_character_,
TRUE ~ .
)))
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
mutate(across(c(total:sd), case_when(
. == "-" ~ 0,
. == "s" ~ NA_character_,
TRUE ~ .
)))
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
mutate(across(c(total:sd), case_when(
. == "-" ~ "0",
. == "s" ~ NA_character_,
TRUE ~ .
)))
str(x)
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
mutate(across(c(total:sd), case_when(
. == "-" ~ "0",
. == "s" ~ "s",
TRUE ~ .
)))
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
mutate(across(c(total:sd), case_when(
. == "-" ~ "0",
#  . == "s" ~ "s",
TRUE ~ .
)))
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
mutate(across(total:sd, case_when(
. == "-" ~ "0",
#  . == "s" ~ "s",
TRUE ~ .
)))
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
mutate(across(total:sd, as.numeric))
View(x)
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
mutate(across(total:sd, case_when(
. == "-" ~ "0"
)))
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
mutate(across(total:sd, ~case_when(
. == "-" ~ "0"
)))
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
mutate(across(total:sd, ~case_when(
. == "-" ~ "0",
. == "s" ~ NA_character_
)))
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
mutate(across(total:sd, ~case_when(
. == "-" ~ "0",
. == "s" ~ NA_character_,
TRUE ~ .
)))
View(x)
x <- read_xlsx('./data/raw/CNA18_C_7_11.xlsx', sheet="7.11.1",
skip=7, col_names = col_names) %>%
select(-starts_with("vacia")) %>%
mutate(link = as.character(link)) %>%
filter(!grepl('Fuente|El total ', link)) %>%
filter(if_any(everything(), ~ !is.na(.))) %>%
fill(link, depto, .direction = "downup")
if (nchar(x$link[1]) == 1){
prov_cod <- paste0("0", x$link[1])
} else {
prov_cod <- x$link[1]
}
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
mutate(across(total:sd, ~case_when(
. == "-" ~ "0",
. == "s" ~ NA_character_,
TRUE ~ .
)))
View(x)
x <- read_xlsx('./data/raw/CNA18_C_7_11.xlsx', sheet="7.11.1",
skip=7, col_names = col_names) %>%
select(-starts_with("vacia")) %>%
mutate(link = as.character(link)) %>%
filter(!grepl('Fuente|El total ', link)) %>%
filter(if_any(everything(), ~ !is.na(.))) %>%
fill(link, depto, .direction = "downup")
if (nchar(x$link[1]) == 1){
prov_cod <- paste0("0", x$link[1])
} else {
prov_cod <- x$link[1]
}
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
mutate(across(total:sd, ~case_when(
. == "-" ~ "0",
. == "s" ~ NA_character_,
TRUE ~ .
))) %>%
mutate(across(total:sd, as.numeric))
format_df <- function(sh, cnames=col_n){
x <- read_xlsx('./data/raw/CNA18_C_7_11.xlsx', sheet=sh,
skip=7, col_names = cnames) %>%
select(-starts_with("vacia")) %>%
mutate(link = as.character(link)) %>%
filter(!grepl('Fuente|El total ', link)) %>%
filter(if_any(everything(), ~ !is.na(.))) %>%
fill(link, depto, .direction = "downup")
if (nchar(x$link[1]) == 1){
prov_cod <- paste0("0", x$link[1])
} else {
prov_cod <- x$link[1]
}
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
mutate(across(total:sd, ~case_when(
. == "-" ~ "0",
. == "s" ~ NA_character_,
TRUE ~ .
))) %>%
mutate(across(total:sd, as.numeric))
}
sheets <- paste0("7.11", 1:23)
sheets
sheets <- paste0("7.11.", 1:23)
map(.x=sheets, .f=format_df)
col_n <- c("link", "depto", "unidad", "total", "agro_asal_todo",
"agro_asal_parte", "agro_tcp", "agro_patron", "vacia",
"no_agro_asal_todo", "no_agro_asal_parte", "no_agro_tcp",
"no_agro_patron", "vacia_2", "sd"
)
map(.x=sheets, .f=format_df)
format_df <- function(sh, cnames=col_n){
x <- read_xlsx('./data/raw/CNA18_C_7_11.xlsx', sheet=sh,
skip=7, col_names = cnames) %>%
select(-starts_with("vacia")) %>%
mutate(link = as.character(link)) %>%
filter(!grepl('Fuente|El total ', link)) %>%
filter(if_any(everything(), ~ !is.na(.))) %>%
fill(link, depto, .direction = "downup")
if (nchar(x$link[1]) == 1){
prov_cod <- paste0("0", x$link[1])
} else {
prov_cod <- x$link[1]
}
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
)
#%>%
#        mutate(across(total:sd, ~case_when(
#                . == "-" ~ "0",
#                . == "s" ~ NA_character_,
#                TRUE ~ .
#        ))) %>%
#        mutate(across(total:sd, as.numeric))
#
}
sheets <- paste0("7.11.", 1:23)
map(.x=sheets, .f=format_df)
map_df(.x=sheets, .f=format_df)
map_dfr(.x=sheets, .f=format_df)
?fill
?replace_na
format_df <- function(sh, cnames=col_n){
x <- read_xlsx('./data/raw/CNA18_C_7_11.xlsx', sheet=sh,
skip=7, col_names = cnames) %>%
select(-starts_with("vacia")) %>%
mutate(link = as.character(link)) %>%
filter(!grepl('Fuente|El total ', link)) %>%
filter(if_any(everything(), ~ !is.na(.))) %>%
fill(link, depto, .direction = "downup")
if (nchar(x$link[1]) == 1){
prov_cod <- paste0("0", x$link[1])
} else {
prov_cod <- x$link[1]
}
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
)
#%>%
#        mutate(across(total:sd, ~case_when(
#                . == "-" ~ "0",
#                . == "s" ~ NA_character_,
#                TRUE ~ .
#        ))) %>%
mutate(across(total:sd, as.numeric)) %>%
replace_na(total:sd, 0)
}
sheets <- paste0("7.11.", 1:23)
map_dfr(.x=sheets, .f=format_df)
format_df <- function(sh, cnames=col_n){
x <- read_xlsx('./data/raw/CNA18_C_7_11.xlsx', sheet=sh,
skip=7, col_names = cnames) %>%
select(-starts_with("vacia")) %>%
mutate(link = as.character(link)) %>%
filter(!grepl('Fuente|El total ', link)) %>%
filter(if_any(everything(), ~ !is.na(.))) %>%
fill(link, depto, .direction = "downup")
if (nchar(x$link[1]) == 1){
prov_cod <- paste0("0", x$link[1])
} else {
prov_cod <- x$link[1]
}
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
)
#%>%
#        mutate(across(total:sd, ~case_when(
#                . == "-" ~ "0",
#                . == "s" ~ NA_character_,
#                TRUE ~ .
#        ))) %>%
mutate(across(total:sd, as.numeric)) %>%
replace_na(0)
}
sheets <- paste0("7.11.", 1:23)
map_dfr(.x=sheets, .f=format_df)
format_df <- function(sh, cnames=col_n){
x <- read_xlsx('./data/raw/CNA18_C_7_11.xlsx', sheet=sh,
skip=7, col_names = cnames) %>%
select(-starts_with("vacia")) %>%
mutate(link = as.character(link)) %>%
filter(!grepl('Fuente|El total ', link)) %>%
filter(if_any(everything(), ~ !is.na(.))) %>%
fill(link, depto, .direction = "downup")
if (nchar(x$link[1]) == 1){
prov_cod <- paste0("0", x$link[1])
} else {
prov_cod <- x$link[1]
}
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
#        mutate(across(total:sd, ~case_when(
#                . == "-" ~ "0",
#                . == "s" ~ NA_character_,
#                TRUE ~ .
#        ))) %>%
mutate(across(total:sd, as.numeric)) %>%
replace_na(0)
}
sheets <- paste0("7.11.", 1:23)
map_dfr(.x=sheets, .f=format_df)
format_df <- function(sh, cnames=col_n){
x <- read_xlsx('./data/raw/CNA18_C_7_11.xlsx', sheet=sh,
skip=7, col_names = cnames) %>%
select(-starts_with("vacia")) %>%
mutate(link = as.character(link)) %>%
filter(!grepl('Fuente|El total ', link)) %>%
filter(if_any(everything(), ~ !is.na(.))) %>%
fill(link, depto, .direction = "downup")
if (nchar(x$link[1]) == 1){
prov_cod <- paste0("0", x$link[1])
} else {
prov_cod <- x$link[1]
}
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
#        mutate(across(total:sd, ~case_when(
#                . == "-" ~ "0",
#                . == "s" ~ NA_character_,
#                TRUE ~ .
#        ))) %>%
mutate(across(total:sd, as.numeric)) %>%
mutate(across(total:sd, ~replace_na(.x, 0)))
}
sheets <- paste0("7.11.", 1:23)
map_dfr(.x=sheets, .f=format_df)
warnings()
pluriact <- map_dfr(.x=sheets, .f=format_df)
library(tidyverse)
library(readxl)
col_n <- c("link", "depto", "unidad", "total", "agro_asal_todo",
"agro_asal_parte", "agro_tcp", "agro_patron", "vacia",
"no_agro_asal_todo", "no_agro_asal_parte", "no_agro_tcp",
"no_agro_patron", "vacia_2", "sd"
)
format_df <- function(sh, cnames=col_n){
x <- read_xlsx('./data/raw/CNA18_C_7_11.xlsx', sheet=sh,
skip=7, col_names = cnames) %>%
select(-starts_with("vacia")) %>%
mutate(link = as.character(link)) %>%
filter(!grepl('Fuente|El total ', link)) %>%
filter(if_any(everything(), ~ !is.na(.))) %>%
fill(link, depto, .direction = "downup")
if (nchar(x$link[1]) == 1){
prov_cod <- paste0("0", x$link[1])
} else {
prov_cod <- x$link[1]
}
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
#        mutate(across(total:sd, ~case_when(
#                . == "-" ~ "0",
#                . == "s" ~ NA_character_,
#                TRUE ~ .
#        ))) %>%
mutate(across(total:sd, as.numeric)) %>%
mutate(across(total:sd, ~replace_na(.x, 0)))
}
pluriact <- map_dfr(.x=paste0("7.11.", 1:23), .f=format_df)
View(pluriact)
format_df <- function(sh, cnames=col_n){
x <- read_xlsx('./data/raw/CNA18_C_7_11.xlsx', sheet=sh,
skip=7, col_names = cnames) %>%
select(-starts_with("vacia")) %>%
mutate(link = as.character(link)) %>%
filter(!grepl('Fuente|El total ', link)) %>%
filter(if_any(everything(), ~ !is.na(.))) %>%
fill(link, depto, .direction = "downup")
if (nchar(x$link[1]) == 1){
prov_cod <- paste0("0", x$link[1])
} else {
prov_cod <- x$link[1]
prov_label <- x$depto[1])
format_df <- function(sh, cnames=col_n){
x <- read_xlsx('./data/raw/CNA18_C_7_11.xlsx', sheet=sh,
skip=7, col_names = cnames) %>%
select(-starts_with("vacia")) %>%
mutate(link = as.character(link)) %>%
filter(!grepl('Fuente|El total ', link)) %>%
filter(if_any(everything(), ~ !is.na(.))) %>%
fill(link, depto, .direction = "downup")
if (nchar(x$link[1]) == 1){
prov_cod <- paste0("0", x$link[1])
} else {
prov_cod <- x$link[1]
prov_label <- x$depto[1]
}
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
#        mutate(across(total:sd, ~case_when(
#                . == "-" ~ "0",
#                . == "s" ~ NA_character_,
#                TRUE ~ .
#        ))) %>%
mutate(across(total:sd, as.numeric)) %>%
mutate(across(total:sd, ~replace_na(.x, 0))) %>%
filter(depto != prov_label)
}
pluriact <- map_dfr(.x=paste0("7.11.", 1:23), .f=format_df)
View(pluriact)
format_df <- function(sh, cnames=col_n){
x <- read_xlsx('./data/raw/CNA18_C_7_11.xlsx', sheet=sh,
skip=7, col_names = cnames) %>%
select(-starts_with("vacia")) %>%
mutate(link = as.character(link)) %>%
filter(!grepl('Fuente|El total ', link)) %>%
filter(if_any(everything(), ~ !is.na(.))) %>%
fill(link, depto, .direction = "downup")
if (nchar(x$link[1]) == 1){
prov_cod <- paste0("0", x$link[1])
} else {
prov_cod <- x$link[1]
}
prov_label <- x$depto[1]
x <- x %>%
mutate(link = case_when(
nchar(link) == 1 ~ paste0(prov_cod, "00", link),
nchar(link) == 2 ~ paste0(prov_cod, "0", link),
TRUE ~ paste0(prov_cod, link))
) %>%
#        mutate(across(total:sd, ~case_when(
#                . == "-" ~ "0",
#                . == "s" ~ NA_character_,
#                TRUE ~ .
#        ))) %>%
mutate(across(total:sd, as.numeric)) %>%
mutate(across(total:sd, ~replace_na(.x, 0))) %>%
filter(depto != prov_label)
}
pluriact <- map_dfr(.x=paste0("7.11.", 1:23), .f=format_df)
View(pluriact)
View(pluriact)
1022/2
View(pluriact)
write_csv(pluriact, './data/proc/pluriact_2018.csv')
View(pluriact)
