uso_2018 <- read_csv('./data/raw/2018_uso_suelo_total.csv')
## Limpio campo Indicador
x <- str_split_fixed(uso_2018$Indicador, ' \\| ', n=3)
colnames(x) <- c('periodo', 'periodo_ocupacion', 'cultivo')
x <- as_tibble(x)
x<-x %>%
mutate(cultivo = case_when(
cultivo=='' & periodo_ocupacion=='' & periodo!='' ~ periodo,
TRUE ~ cultivo)
)
x %>%
filter(cultivo == '')
## Limpio campo Indicador
x <- str_split_fixed(uso_2018$Indicador, ' \\| ', n=3)
colnames(x) <- c('periodo', 'periodo_ocupacion', 'cultivo')
x <- as_tibble(x)
x<-x %>%
mutate(cultivo = case_when(
cultivo=='' & periodo_ocupacion=='' & periodo!='' ~ periodo,
cultivo=='' & periodo_ocupacion!='' & periodo=='Total' ~ periodo,
TRUE ~ cultivo)
)
x %>%
filter(cultivo =='')
View(x)
## Limpio campo Indicador
x <- str_split_fixed(uso_2018$Indicador, ' \\| ', n=3)
colnames(x) <- c('periodo', 'periodo_ocupacion', 'cultivo')
x <- as_tibble(x)
uso_2018 <- read_csv('./data/raw/2018_uso_suelo_total.csv')
## Limpio campo Indicador
x <- str_split_fixed(uso_2018$Indicador, ' \\| ', n=3)
colnames(x) <- c('periodo', 'periodo_ocupacion', 'cultivo')
x <- as_tibble(x)
x<-x %>%
mutate(cultivo = case_when(
cultivo=='' & periodo_ocupacion=='' & periodo!='' ~ periodo,
#cultivo=='' & periodo_ocupacion!='' & periodo=='Total' ~ periodo,
cultivo=='' & periodo_ocupacion!='' & periodo=='Primera población' ~ periodo_ocupacion,
TRUE ~ cultivo)
)
x %>%
filter(cultivo =='')
## Limpio campo Indicador
x <- str_split_fixed(uso_2018$Indicador, ' \\| ', n=3)
colnames(x) <- c('periodo', 'periodo_ocupacion', 'cultivo')
x <- as_tibble(x)
x<-x %>%
mutate(cultivo = case_when(
cultivo=='' & periodo_ocupacion=='' & periodo!='' ~ periodo,
cultivo=='' & periodo_ocupacion!='' & periodo=='Total' ~ periodo_ocupacion,
cultivo=='' & periodo_ocupacion!='' & periodo=='Primera población' ~ periodo_ocupacion,
TRUE ~ cultivo)
)
x %>%
filter(cultivo =='')
## Limpio campo Indicador
x <- str_split_fixed(uso_2018$Indicador, ' \\| ', n=3)
colnames(x) <- c('periodo', 'periodo_ocupacion', 'cultivo')
x <- as_tibble(x)
x<-x %>%
mutate(cultivo = case_when(
cultivo=='' & periodo_ocupacion=='' & periodo!='' ~ periodo,
cultivo=='' & periodo_ocupacion!='' & periodo=='Total' ~ periodo_ocupacion,
cultivo=='' & periodo_ocupacion!='' & periodo=='Primera población' ~ periodo_ocupacion,
cultivo=='' & periodo_ocupacion!='' & periodo=='Segunda población' ~ periodo_ocupacion,
TRUE ~ cultivo)
)
x %>%
filter(cultivo =='')
uso_2018 <- uso_2018 %>%
bind_cols(x)
uso_2018 <- uso_2018 %>%
mutate(grupo_cultivo = str_extract(Cuadro, '[^.]+'))
uso_2018 <- uso_2018 %>%
janitor::clean_names() %>%
select(censo, link, provincia, departamento, unidad_de_registro, grupo_cultivo, periodo_ocupacion, cultivo, valor, cuadro, indicador)
totales <- uso_2018 %>%
filter(grepl(c('Total'), indicador))
uso_2018_limpio <- uso_2018 %>%
filter(!grepl(c('Total'), indicador))
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(cultivo) %>%
summarise(valor = sum(valor))
uso_2018_limpio
View(uso_2018_limpio)
uso_2018_limpio %>%
filter(cultivo == '')
xx<-uso_2018_limpio %>%
filter(cultivo == '')
View(xx)
View(xx)
View(uso_2018)
View(uso_2018)
uso_2018 %>% select(grupo_cultivo) %>% unique()
View(xx)
uso_2018 %>% select(indicador) %>% unique()
uso_2018 %>% select(cuadro) %>% unique()
library(tidyverse)
uso_2018 <- read_csv('./data/raw/2018_uso_suelo_total.csv')
## Limpio campo Indicador
x <- str_split_fixed(uso_2018$Indicador, ' \\| ', n=3)
colnames(x) <- c('periodo', 'periodo_ocupacion', 'cultivo')
x <- as_tibble(x)
x<-x %>%
mutate(cultivo = case_when(
cultivo=='' & periodo_ocupacion=='' & periodo!='' ~ periodo,
cultivo=='' & periodo_ocupacion!='' & periodo=='Total' ~ periodo_ocupacion,
cultivo=='' & periodo_ocupacion!='' & periodo=='Primera población' ~ periodo_ocupacion,
cultivo=='' & periodo_ocupacion!='' & periodo=='Segunda población' ~ periodo_ocupacion,
TRUE ~ cultivo)
)
x %>%
filter(cultivo =='')
uso_2018 <- uso_2018 %>%
bind_cols(x)
uso_2018 <- uso_2018 %>%
mutate(grupo_cultivo = str_extract(Cuadro, '[^.]+'))
uso_2018 <- uso_2018 %>%
janitor::clean_names() %>%
select(censo, link, provincia, departamento, unidad_de_registro, grupo_cultivo, periodo_ocupacion, cultivo, valor, cuadro, indicador)
totales <- uso_2018 %>%
filter(grepl(c('Total'), indicador))
uso_2018_limpio <- uso_2018 %>%
filter(!grepl(c('Total'), indicador))
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(cultivo) %>%
summarise(valor = sum(valor))
xx<-uso_2018_limpio %>%
filter(cultivo == '')
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor))
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
top_n(10)
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
arrange(valor = desc(valor)) %>%
top_n(10)
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
top_n(10) %>%
arrange(valor = desc(valor)) %>%
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
top_n(10) %>%
arrange(valor = desc(valor))
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
top_n(10) %>%
arrange(valor = desc(valor))
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
top_n(10) %>%
arrange(desc(provincia, valor))
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
arrange(desc(provincia, valor)) %>%
top_n(10) %>%
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
arrange(desc(provincia, valor)) %>%
top_n(10)
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
arrange(desc(valor, provincia)) %>%
top_n(10)
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
arrange(desc(provincia, valor)) %>%
top_n(10)
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
group_by(provincia)
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
group_by(provincia) %>%
top_n(10)
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
group_by(provincia) %>%
arrange(desc(valor)) %>%
top_n(10)
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
group_by(provincia) %>%
top_n(10)
select <- uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
group_by(provincia) %>%
top_n(10)
library(tidyverse)
uso_2018 <- read_csv('./data/raw/2018_uso_suelo_total.csv')
## Limpio campo Indicador
x <- str_split_fixed(uso_2018$Indicador, ' \\| ', n=3)
colnames(x) <- c('periodo', 'periodo_ocupacion', 'cultivo')
x <- as_tibble(x)
x<-x %>%
mutate(cultivo = case_when(
cultivo=='' & periodo_ocupacion=='' & periodo!='' ~ periodo,
cultivo=='' & periodo_ocupacion!='' & periodo=='Total' ~ periodo_ocupacion,
cultivo=='' & periodo_ocupacion!='' & periodo=='Primera población' ~ periodo_ocupacion,
cultivo=='' & periodo_ocupacion!='' & periodo=='Segunda población' ~ periodo_ocupacion,
TRUE ~ cultivo)
)
x %>%
filter(cultivo =='')
uso_2018 <- uso_2018 %>%
bind_cols(x)
uso_2018 <- uso_2018 %>%
mutate(grupo_cultivo = str_extract(Cuadro, '[^.]+'))
uso_2018 <- uso_2018 %>%
janitor::clean_names() %>%
select(censo, link, provincia, departamento, unidad_de_registro, grupo_cultivo, periodo_ocupacion, cultivo, valor, cuadro, indicador)
totales <- uso_2018 %>%
filter(grepl(c('Total'), indicador))
uso_2018_limpio <- uso_2018 %>%
filter(!grepl(c('Total'), indicador))
provincias <- uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
group_by(provincia) %>%
top_n(10)
View(provincias)
provincias <- uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
group_by(provincia) %>%
top_n(10) %>%
ungroup()
provincias <- uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
group_by(provincia) %>%
top_n(10) %>%
ungroup() %>%
unique()
provincias <- uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor)) %>%
group_by(provincia) %>%
top_n(10) %>%
ungroup() %>%
select(cultivo) %>%
unique()
View(provincias)
provincias <- uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, group_cultivo, cultivo) %>%
summarise(valor = sum(valor)) %>%
group_by(provincia) %>%
top_n(10) %>%
ungroup() %>%
select(grupo_cultivo, cultivo) %>%
unique()
provincias <- uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, grupo_cultivo, cultivo) %>%
summarise(valor = sum(valor)) %>%
group_by(provincia) %>%
top_n(10) %>%
ungroup() %>%
select(grupo_cultivo, cultivo) %>%
unique()
View(provincias)
library(tidyverse)
uso_2018 <- read_csv('./data/raw/2018_uso_suelo_total.csv')
## Limpio campo Indicador
x <- str_split_fixed(uso_2018$Indicador, ' \\| ', n=3)
colnames(x) <- c('periodo', 'periodo_ocupacion', 'cultivo')
x <- as_tibble(x)
x<-x %>%
mutate(cultivo = case_when(
cultivo=='' & periodo_ocupacion=='' & periodo!='' ~ periodo,
cultivo=='' & periodo_ocupacion!='' & periodo=='Total' ~ periodo_ocupacion,
cultivo=='' & periodo_ocupacion!='' & periodo=='Primera población' ~ periodo_ocupacion,
cultivo=='' & periodo_ocupacion!='' & periodo=='Segunda población' ~ periodo_ocupacion,
TRUE ~ cultivo)
)
x %>%
filter(cultivo =='')
uso_2018 <- uso_2018 %>%
bind_cols(x)
## Limpio campo Cuadro
uso_2018 <- uso_2018 %>%
mutate(grupo_cultivo = str_extract(Cuadro, '[^.]+'))
## Ordeno variables
uso_2018 <- uso_2018 %>%
janitor::clean_names() %>%
select(censo, link, provincia, departamento, unidad_de_registro, grupo_cultivo, periodo_ocupacion, cultivo, valor, cuadro, indicador)
## Eliminar lo que contiene totales...
totales <- uso_2018 %>%
filter(grepl(c('Total'), indicador))
uso_2018_limpio <- uso_2018 %>%
filter(!grepl(c('Total'), indicador))
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor))
xxx<-uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, cultivo) %>%
summarise(valor = sum(valor))
View(xxx)
xxx %>%
filter(cultivo == 'Soja')
xxxx<-xxx %>%
filter(cultivo == 'Soja')
View(xxxx)
uso_2018_limpio %>%
select(cultivo) %>%
unique()
cultivos_clasificar <- uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
group_by(provincia, grupo_cultivo, cultivo) %>%
summarise(valor = sum(valor)) %>%
group_by(provincia) %>%
top_n(10) %>%
ungroup() %>%
select(grupo_cultivo, cultivo) %>%
unique()
uso_2018_limpio %>%
select(grupo_cultivo, cultivo) %>%
distinct()
uso_2018_limpio %>%
select(grupo_cultivo, cultivo) %>%
unique()
cultivos_clasificar <- uso_2018_limpio %>%
select(grupo_cultivo, cultivo) %>%
unique()
uso_2018_limpio %>%
select(grupo_cultivo, cultivo) %>%
distinct() %>%
write_csv('./data/outputs/listado_cultivos.csv')
uso_2018_limpio %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor),
prop = has/sum(has))
uso_2018_limpio %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor)) %>%
mutate(prop = has/sum(has))
uso_2018_limpio %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor)) %>%
mutate(prop = has/sum(has)) %>%
summarise(x=sum(prop))
uso_2018_limpio %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor)) %>%
ungroup() %>%
mutate(prop = has/sum(has)) %>%
summarise(x=sum(prop))
uso_2018_limpio %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor)) %>%
ungroup() %>%
mutate(prop = has/sum(has))
mutate(prop = has/sum(has))
uso_2018_limpio %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor)) %>%
group_by(grupo_cultivo()) %>%
mutate(prop = has/sum(has))
group_by(grupo_cultivo %>%
uso_2018_limpio %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor)) %>%
group_by(grupo_cultivo) %>%
mutate(prop = has/sum(has))
uso_2018_limpio %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor)) %>%
group_by(grupo_cultivo) %>%
mutate(prop = has/sum(has)) %>%
sum(prop)
uso_2018_limpio %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor)) %>%
group_by(grupo_cultivo) %>%
mutate(prop = has/sum(has)) %>%
select(prop) %>%
sum(prop)
uso_2018_limpio %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor)) %>%
group_by(grupo_cultivo) %>%
mutate(prop = has/sum(has))
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor)) %>%
group_by(grupo_cultivo) %>%
mutate(prop = has/sum(has)) %>%
select(prop) %>%
sum(prop)
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor)) %>%
group_by(grupo_cultivo) %>%
mutate(prop = has/sum(has)) %>%
select(prop)
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor)) %>%
group_by(grupo_cultivo) %>%
mutate(prop = has/sum(has)) %>%
select(prop) %>%
summarise(x=sum(prop))
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor)) %>%
group_by(grupo_cultivo) %>%
mutate(prop = has/sum(has))
distinct()
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor)) %>%
group_by(grupo_cultivo) %>%
mutate(prop = has/sum(has))
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor)) %>%
group_by(grupo_cultivo) %>%
mutate(prop = has/sum(has)) %>%
arrange(desc(prop))
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor)) %>%
group_by(grupo_cultivo) %>%
mutate(prop = has/sum(has)) %>%
arrange(grupo_cultivo, desc(prop))
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor)) %>%
group_by(grupo_cultivo) %>%
mutate(prop = has/sum(has)) %>%
arrange(grupo_cultivo, desc(prop)) %>%
write_csv('./data/outputs/listado_cultivos.csv')
uso_2018_limpio %>%
mutate(valor = if_else(valor == -1, 0, valor)) %>%
select(grupo_cultivo, cultivo, valor) %>%
group_by(grupo_cultivo, cultivo) %>%
summarise(has = sum(valor)) %>%
group_by(grupo_cultivo) %>%
mutate(prop = has/sum(has)) %>%
arrange(grupo_cultivo, desc(prop)) %>%
ungroup() %>%
write_csv('./data/outputs/listado_cultivos.csv')
